---
import "../styles/global.css";
---
<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/png" href="/favicon.png" />
		<meta name="generator" content={Astro.generator} />
		<title>Nova Forum</title>
	</head>
	<body class="font-sans antialiased">
		<slot />
		<script>
			const supportsVT = 'startViewTransition' in document;
			const prefersReduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
			if (supportsVT && !prefersReduce) {
				document.addEventListener('click', (e) => {
					const target = e.target as (Element | null);
					if (!target || typeof (target as any).closest !== 'function') return;
					const a = target.closest('a') as HTMLAnchorElement | null;
					if (!a) return;
					const href = a.getAttribute('href');
					if (!href) return;
					const isHash = href.startsWith('#');
					const isExternal = a.target === '_blank' || (/^https?:\/\//.test(href) && new URL(href, location.href).origin !== location.origin);
					const isDownload = a.hasAttribute('download');
					const isModified = e.metaKey || e.ctrlKey || e.shiftKey || e.altKey || e.button !== 0;
					const isInternal = href.startsWith('/') && !isExternal;
					if (!isInternal || isHash || isDownload || isModified) return;
					e.preventDefault();
					document.startViewTransition(() => {
						window.location.href = href;
					});
				});
			}
		</script>
		<script>
			// Redirección automática si hay sesión guardada y el usuario entra a páginas públicas
			try {
				const raw = localStorage.getItem('user');
				if (raw) {
					const u = JSON.parse(raw);
					const role = Number(u?.Num_rol);
					const routes: Record<number, string> = { 1: '/admin', 2: '/investigador', 3: '/revisor', 4: '/cliente' };
					const target = routes[role] || '/';
					const here = window.location.pathname;
					const publicPages = new Set(['/', '/landing', '/login']);
					if (publicPages.has(here) && here !== target) {
						window.location.replace(target);
					}
				}
			} catch {}
		</script>
	</body>
</html>

<style>
	html,
	body {
		margin: 0;
		width: 100%;
		height: 100%;
	}
</style>
